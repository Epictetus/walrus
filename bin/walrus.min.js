((function(){var a,b,c,d,e=Object.prototype.hasOwnProperty,f=function(a,b){function d(){this.constructor=a}for(var c in b)e.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};d={VERSION:"0.0.4"};var g=function(){var a={trace:function(){},yy:{},symbols_:{error:2,document:3,text:4,EOF:5,statements:6,statement:7,OPEN:8,helper:9,mustache:10,OPEN_BLOCK:11,CLOSE_BLOCK:12,CLOSE:13,CONTENT:14,expression:15,PIPE:16,filters:17,ATTR:18,paths:19,DOT:20,HELP:21,MEMBER:22,filter:23,path:24,method:25,member:26,OPEN_PAREN:27,arguments:28,CLOSE_PAREN:29,COMMA:30,argument:31,SINGLE_QUOTE_STRING_LITERAL:32,DOUBLE_QUOTE_STRING_LITERAL:33,BOOLEAN_FALSE:34,BOOLEAN_TRUE:35,NUMBER:36,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",8:"OPEN",11:"OPEN_BLOCK",12:"CLOSE_BLOCK",13:"CLOSE",14:"CONTENT",16:"PIPE",18:"ATTR",20:"DOT",21:"HELP",22:"MEMBER",27:"OPEN_PAREN",29:"CLOSE_PAREN",30:"COMMA",32:"SINGLE_QUOTE_STRING_LITERAL",33:"DOUBLE_QUOTE_STRING_LITERAL",34:"BOOLEAN_FALSE",35:"BOOLEAN_TRUE",36:"NUMBER"},productions_:[0,[3,2],[4,1],[6,2],[6,1],[7,7],[7,3],[7,1],[10,3],[10,1],[15,2],[15,1],[15,1],[9,2],[17,2],[17,1],[23,2],[19,3],[19,1],[24,1],[24,1],[25,4],[25,3],[28,3],[28,1],[31,1],[31,1],[31,1],[31,1],[31,1],[31,1],[26,1]],performAction:function(b,c,d,e,f,g,h){var i=g.length-1;switch(f){case 1:return new e.DocumentNode(g[i-1]);case 2:this.$=g[i];break;case 3:g[i-1].push(g[i]),this.$=g[i-1];break;case 4:this.$=[g[i]];break;case 5:this.$=new e.BlockNode(g[i-5],g[i-4],new e.NodeCollection(g[i-2]));break;case 6:this.$=g[i-1];break;case 7:this.$=new e.ContentNode(g[i]);break;case 8:this.$=new e.ExpressionNode(g[i-2],new e.FilterCollection(g[i]));break;case 9:this.$=new e.ExpressionNode(g[i],new e.FilterCollection([]));break;case 10:this.$=new e.PathNode(g[i],!1);break;case 11:this.$=new e.PathNode(g[i],!0);break;case 12:this.$=new e.ThisNode;break;case 13:this.$=g[i];break;case 14:g[i-1].push(g[i]),this.$=g[i-1];break;case 15:this.$=[g[i]];break;case 16:this.$=g[i];break;case 17:g[i-2].push(g[i]),this.$=g[i-2];break;case 18:this.$=[g[i]];break;case 19:this.$=g[i];break;case 20:this.$=g[i];break;case 21:this.$=new e.MethodNode(g[i-3],g[i-1]);break;case 22:this.$=new e.MethodNode(g[i-2],[]);break;case 23:g[i-2].push(g[i]),this.$=g[i-2];break;case 24:this.$=[g[i]];break;case 25:this.$=g[i];break;case 26:this.$=new e.PrimitiveNode(g[i]);break;case 27:this.$=new e.PrimitiveNode(g[i]);break;case 28:this.$=new e.PrimitiveNode(!1);break;case 29:this.$=new e.PrimitiveNode(!0);break;case 30:this.$=new e.PrimitiveNode(parseFloat(g[i]));break;case 31:this.$=new e.MemberNode(g[i])}},table:[{3:1,4:2,6:3,7:4,8:[1,5],14:[1,6]},{1:[3]},{5:[1,7]},{5:[2,2],7:8,8:[1,5],12:[2,2],14:[1,6]},{5:[2,4],8:[2,4],12:[2,4],14:[2,4]},{9:9,10:10,15:12,18:[1,13],19:14,20:[1,15],21:[1,11],22:[1,19],24:16,25:17,26:18},{5:[2,7],8:[2,7],12:[2,7],14:[2,7]},{1:[2,1]},{5:[2,3],8:[2,3],12:[2,3],14:[2,3]},{10:20,15:12,18:[1,13],19:14,20:[1,15],22:[1,19],24:16,25:17,26:18},{13:[1,21]},{22:[1,22]},{11:[2,9],13:[2,9],16:[1,23]},{19:24,22:[1,19],24:16,25:17,26:18},{11:[2,11],13:[2,11],16:[2,11],20:[1,25],29:[2,11],30:[2,11]},{11:[2,12],13:[2,12],16:[2,12],29:[2,12],30:[2,12]},{11:[2,18],13:[2,18],16:[2,18],20:[2,18],29:[2,18],30:[2,18]},{11:[2,19],13:[2,19],16:[2,19],20:[2,19],29:[2,19],30:[2,19]},{11:[2,20],13:[2,20],16:[2,20],20:[2,20],29:[2,20],30:[2,20]},{11:[2,31],13:[2,31],16:[2,31],20:[2,31],27:[1,26],29:[2,31],30:[2,31]},{11:[1,27]},{5:[2,6],8:[2,6],12:[2,6],14:[2,6]},{18:[2,13],20:[2,13],22:[2,13]},{17:28,21:[1,30],23:29},{11:[2,10],13:[2,10],16:[2,10],20:[1,25],29:[2,10],30:[2,10]},{22:[1,19],24:31,25:17,26:18},{15:35,18:[1,13],19:14,20:[1,15],22:[1,19],24:16,25:17,26:18,28:32,29:[1,33],31:34,32:[1,36],33:[1,37],34:[1,38],35:[1,39],36:[1,40]},{4:41,6:3,7:4,8:[1,5],14:[1,6]},{11:[2,8],13:[2,8],21:[1,30],23:42},{11:[2,15],13:[2,15],21:[2,15]},{22:[1,43]},{11:[2,17],13:[2,17],16:[2,17],20:[2,17],29:[2,17],30:[2,17]},{29:[1,44],30:[1,45]},{11:[2,22],13:[2,22],16:[2,22],20:[2,22],29:[2,22],30:[2,22]},{29:[2,24],30:[2,24]},{29:[2,25],30:[2,25]},{29:[2,26],30:[2,26]},{29:[2,27],30:[2,27]},{29:[2,28],30:[2,28]},{29:[2,29],30:[2,29]},{29:[2,30],30:[2,30]},{12:[1,46]},{11:[2,14],13:[2,14],21:[2,14]},{11:[2,16],13:[2,16],21:[2,16]},{11:[2,21],13:[2,21],16:[2,21],20:[2,21],29:[2,21],30:[2,21]},{15:35,18:[1,13],19:14,20:[1,15],22:[1,19],24:16,25:17,26:18,31:47,32:[1,36],33:[1,37],34:[1,38],35:[1,39],36:[1,40]},{13:[1,48]},{29:[2,23],30:[2,23]},{5:[2,5],8:[2,5],12:[2,5],14:[2,5]}],defaultActions:{7:[2,1]},parseError:function(b,c){throw new Error(b)},parse:function(b){function o(a){d.length=d.length-2*a,e.length=e.length-a,f.length=f.length-a}function p(){var a;return a=c.lexer.lex()||1,typeof a!="number"&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0,l=2,m=1;this.lexer.setInput(b),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var n=this.lexer.yylloc;f.push(n),typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var q,r,s,t,u,v,w={},x,y,z,A;for(;;){s=d[d.length-1],this.defaultActions[s]?t=this.defaultActions[s]:(q==null&&(q=p()),t=g[s]&&g[s][q]);if(typeof t=="undefined"||!t.length||!t[0]){if(!k){A=[];for(x in g[s])this.terminals_[x]&&x>2&&A.push("'"+this.terminals_[x]+"'");var B="";this.lexer.showPosition?B="Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+A.join(", ")+", got '"+this.terminals_[q]+"'":B="Parse error on line "+(i+1)+": Unexpected "+(q==1?"end of input":"'"+(this.terminals_[q]||q)+"'"),this.parseError(B,{text:this.lexer.match,token:this.terminals_[q]||q,line:this.lexer.yylineno,loc:n,expected:A})}if(k==3){if(q==m)throw new Error(B||"Parsing halted.");j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,n=this.lexer.yylloc,q=p()}for(;;){if(l.toString()in g[s])break;if(s==0)throw new Error(B||"Parsing halted.");o(1),s=d[d.length-1]}r=q,q=l,s=d[d.length-1],t=g[s]&&g[s][l],k=3}if(t[0]instanceof Array&&t.length>1)throw new Error("Parse Error: multiple actions possible at state: "+s+", token: "+q);switch(t[0]){case 1:d.push(q),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(t[1]),q=null,r?(q=r,r=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,n=this.lexer.yylloc,k>0&&k--);break;case 2:y=this.productions_[t[1]][1],w.$=e[e.length-y],w._$={first_line:f[f.length-(y||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(y||1)].first_column,last_column:f[f.length-1].last_column},v=this.performAction.call(w,h,j,i,this.yy,t[1],e,f);if(typeof v!="undefined")return v;y&&(d=d.slice(0,-1*y*2),e=e.slice(0,-1*y),f=f.slice(0,-1*y)),d.push(this.productions_[t[1]][0]),e.push(w.$),f.push(w._$),z=g[d[d.length-2]][d[d.length-1]],d.push(z);break;case 3:return!0}}return!0}},b=function(){var a={EOF:1,parseError:function(b,c){if(this.yy.parseError)this.yy.parseError(b,c);else throw new Error(b)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.match+=a,this.matched+=a;var b=a.match(/\n/);return b&&this.yylineno++,this._input=this._input.slice(1),a},unput:function(a){return this._input=a+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=(new Array(a.length+1)).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d;this._more||(this.yytext="",this.match="");var e=this._currentRules();for(var f=0;f<e.length;f++){b=this._input.match(this.rules[e[f]]);if(b){d=b[0].match(/\n.*/g),d&&(this.yylineno+=d.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:d?d[d.length-1].length-1:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,e[f],this.conditionStack[this.conditionStack.length-1]);if(a)return a;return}}if(this._input==="")return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var b=this.next();return typeof b!="undefined"?b:this.lex()},begin:function(b){this.conditionStack.push(b)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(b){this.begin(b)}};return a.performAction=function(b,c,d,e){var f=e;switch(d){case 0:this.begin("mu");if(c.yytext)return 14;break;case 1:return 14;case 2:return this.begin("INITIAL"),11;case 3:return 12;case 4:return 8;case 5:return this.begin("INITIAL"),13;case 6:return 18;case 7:return 21;case 8:return 16;case 9:return 20;case 10:return 30;case 11:break;case 12:return c.yytext=c.yytext.substr(1,c.yyleng-2),32;case 13:return c.yytext=c.yytext.substr(1,c.yyleng-2),33;case 14:return 27;case 15:return 29;case 16:return 35;case 17:return 34;case 18:return 36;case 19:return 22;case 20:return 5}},a.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^do\s*\}\}/,/^\{\{\s*end\b/,/^\{\{/,/^\}\}/,/^@/,/^:/,/^\|/,/^\./,/^,/,/^\s+/,/^'[^\']*?'/,/^"[^\"]*?"/,/^\(/,/^\)/,/^true\b/,/^false\b/,/^\d+(\.\d+)?/,/^[a-zA-Z0-9\_]+/,/^$/],a.conditions={mu:{rules:[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],inclusive:!1},INITIAL:{rules:[0,1,20],inclusive:!0}},a}();return a.lexer=b,a}();typeof require!="undefined"&&typeof exports!="undefined"&&(exports.parser=g,exports.parse=function(){return g.parse.apply(g,arguments)},exports.main=function(b){if(!b[1])throw new Error("Usage: "+b[0]+" FILE");if(typeof process!="undefined")var c=require("fs").readFileSync(require("path").join(process.cwd(),b[1]),"utf8");else var d=require("file").path(require("file").cwd()),c=d.join(b[1]).read({charset:"utf-8"});return exports.parser.parse(c)},typeof module!="undefined"&&require.main===module&&exports.main(typeof process!="undefined"?process.argv.slice(1):require("system").args)),a={trim:function(a){return a.replace(/^\s+|\s+$/g,"")}},a.NodeCollection=function(){function b(a){this.nodes=a}return b.prototype.compile=function(b,c){var d;return a.trim(function(){var a,e,f,g;f=this.nodes,g=[];for(a=0,e=f.length;a<e;a++)d=f[a],g.push(d.compile(b,c));return g}.call(this).join(""))},b}(),a.DocumentNode=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.compile=function(a){return b.__super__.compile.call(this,a,a)+"\n"},b}(a.NodeCollection),a.ContentNode=function(){function a(a){this.content=a}return a.prototype.compile=function(a,b){return this.content},a}(),a.MemberNode=function(){function a(a){this.path=a}return a.prototype.compile=function(a,b,c){return a[this.path]},a}(),a.MethodNode=function(){function a(a,b){this.path=a,this.arguments=b}return a.prototype.compile=function(a,b,c){var d;return a[this.path].apply(a,function(){var a,e,f,g;f=this.arguments,g=[];for(a=0,e=f.length;a<e;a++)d=f[a],g.push(d.compile(b,c));return g}.call(this))},a}(),a.ThisNode=function(){function a(){}return a.prototype.compile=function(a,b){return a},a}(),a.PathNode=function(){function a(a,b){this.paths=a,this.local=b}return a.prototype.compile=function(a,b){var c,d;c=this.local?a:b,d=this.paths.concat();while(d.length!==0)c=d.shift().compile(c,a,b);return c},a}(),a.PrimitiveNode=function(){function a(a){this.value=a}return a.prototype.compile=function(a,b){return this.value},a}(),a.ExpressionNode=function(){function a(a,b){this.paths=a,this.filters=b}return a.prototype.compile=function(a,b){return this.filters.apply(this.paths.compile(a,b))},a}(),a.BlockNode=function(){function a(a,b,c){this.helper=a,this.expression=b,this.block=c}return a.prototype.compile=function(a,b){return d.Helpers[this.helper](this.expression,a,b,this.block)},a}(),a.FilterCollection=function(){function a(a){this.names=a}return a.prototype.apply=function(a){var b,c,e,f,g;c=a,g=this.names;for(e=0,f=g.length;e<f;e++)b=g[e],c=d.Filters[b](c);return c},a}(),d.AST=a,c={add:function(a,b){return this[a]=b}},c.add("if",function(a,b,c,d){return a.compile(b,c)?d.compile(b,c):""}),c.add("each",function(a,b,c,d){var e,f;return f=function(){var f,g,h,i;h=a.compile(b,c),i=[];for(f=0,g=h.length;f<g;f++)e=h[f],i.push(d.compile(e,c));return i}(),f.join("")}),c.add("with",function(a,b,c,d){return d.compile(a.compile(b,c),c)}),d.Helpers=c,b={add:function(a,b){return this[a]=b}},b.add("reverse",function(a){return a.split("").reverse().join("")}),b.add("downcase",function(a){return a.toLowerCase()}),b.add("upcase",function(a){return a.toUpperCase()}),d.Filters=b,d.Parser={parser:g,parse:function(){return g.parse.apply(g,arguments)}},d.Parser.parser.yy=d.AST,typeof require!="undefined"&&require!==null&&typeof exports!="undefined"&&exports!==null?module.exports=d:window.Walrus=d})).call(this)